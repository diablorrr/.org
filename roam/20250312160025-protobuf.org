:PROPERTIES:
:ID:       13f67abf-4087-4d20-87d7-ed11e5b99edc
:END:
#+title: Protocol Buffers
#+filetags: grpc

* Protocol Buffers [[https://protobuf.dev/getting-started/cpptutorial/][Protocol Buffers官网]]
google开发的语言无关、平台无关的 *结构化数据序列化协议* ，体积更小、解析更快、但可读性差（相比 JSON）；定义在 .proto文件，使用 protoc 编译生成 .pb.h、.pb.cc 文件

*.pb文件中的方法* ：
1. 基本字段           ：get()、set_xxx()、has_xxx()、clear_xxx() [fn:1]
2. repeated修饰的字段 ：xxx_size()、xxx(index)、add_xxx()、mutable_xxx() [fn:2]
   - repeated修饰的字段 :: 包含多个相同类型的值，类似"数组"


* Footnotes
[fn:2]
#+begin_example cpp
/* .proto定义
message Chat {
  repeated string messages = 1;
  repeated User members = 2;  // 嵌套消息类型
}
*/

// 1. 获取列表信息
int messages_size() const;                  // 获取 messages 列表长度
int members_size() const;                   // 获取 members 列表长度

// 2. 访问列表元素（通过索引）
const std::string& messages(int index) const;  // 获取 messages 第 index 个元素
const User& members(int index) const;          // 获取 members 第 index 个元素

// 3. 添加元素（推荐方式）
std::string* add_messages();                 // 新增一个空字符串到 messages，返回指针
User* add_members();                         // 新增一个空 User 到 members，返回指针

// 4. 直接操作底层容器（返回 vector 类似物的引用）
google::protobuf::RepeatedPtrField<std::string>* mutable_messages();
google::protobuf::RepeatedPtrField<User>* mutable_members();

// 示例：通过容器操作
auto* members = chat.mutable_members();
User new_user;
new_user.set_id(100);
members->Add()->CopyFrom(new_user);  // 复制一个 User 到列表

// 5. 清空列表
void clear_messages();
void clear_members();
#+end_example


[fn:1]
#+begin_example cpp
/* .proto定义
message User {
  int32 id = 1;
  string name = 2;
  bool is_active = 3;
}
*/

// 获取字段值
int32_t id() const;                  // 返回 id 的值
const std::string& name() const;     // 返回 name 的值（string 类型返回引用）
bool is_active() const;              // 返回 is_active 的值

// 设置字段值
void set_id(int32_t value);          // 设置 id 的值
void set_name(const std::string& value);  // 设置 name 的值
void set_is_active(bool value);      // 设置 is_active 的值

// 清空字段（恢复默认值）
void clear_id();
void clear_name();
void clear_is_active();

// 判断字段是否被显式设置（非默认值）
bool has_id() const;
bool has_name() const;
bool has_is_active() const;
#+end_example
