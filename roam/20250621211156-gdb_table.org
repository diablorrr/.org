:PROPERTIES:
:ID:       838ac6cf-8fd7-4193-9163-6ca32ffb6d00
:END:
#+title: gdb cheat sheet
#+filetags: gdb

* 终端命令
| 命令 | 参数                     | 作用                         |
|------+--------------------------+------------------------------|
| gdb  | <可执行文件> <core dump> | 进入gdb，[调试core dump文件] |
|      | -p <进程编号>            | 调试正在运行的进程           |
|      | -d <源代码目录>          | 设置源码目录                 |


* gdb命令
| 常用 | 快捷键                 | 作用                                                                       |
|------+------------------------+----------------------------------------------------------------------------|
|      | file <二进制文件>      | 加载文件符号                                                               |
|      | set args               | 设置程序的运行参数([[id:c83f7932-3d36-4d54-8252-151cb74951d1][main函数]]的参数)                                         |
|      | set var                | 设置变量的值                                                               |
| *    | r                      | 运行/重新运行程序                                                          |
| *    | u <行号>               | 运行直到某一行                                                             |
| *    | attach                 | 附加到进程(需要sudo启动gdb)                                                |
| *    | directory <源代码目录> | 设置源代码搜索目录                                                         |
|------+------------------------+----------------------------------------------------------------------------|
| *    | bt                     | 查看当前调用栈                                                             |
|      | i thread               | 查看所有线程                                                               |
|      | f <帧编号>             | 切换帧                                                                     |
|------+------------------------+----------------------------------------------------------------------------|
| *    | b <> [if <exp>]        | 打断点(空的话是在当前行打断点)；[]条件断点                                 |
| *    | tb                     | 临时断点                                                                   |
| *    | i b                    | 查看所有断点                                                               |
| *    | d <断点数字>           | 删除断点                                                                   |
|      | save <文件.gdb>        | 保存断点到文件(.gdb文件里可以写：run、file之类的命令)                      |
|      | source <文件.gdb>      | 加载保存的断点                                                             |
|------+------------------------+----------------------------------------------------------------------------|
|      | watch <var> [if <exp>] | 监视变量(值写入时暂停)                                                     |
|      | rwatch <var>           | 监视变量(值读取时暂停)                                                     |
|      | awatch <var>           | 监视变量(值写入、读取时暂停)                                               |
|------+------------------------+----------------------------------------------------------------------------|
| *    | p <var/func>           | 打印变量的值；也能打印函数，会执行[fn:1]；string类型需要调用operator[fn:2] |
|      | whatis <>              | 打印类型名称                                                               |
|      | ptype <>               | 打印复杂类型详细定义                                                       |
|------+------------------------+----------------------------------------------------------------------------|


* 调度器锁模式
*调度器锁模式* ：控制调试时，其他线程的行为； =set scheduler-locking <mode>= -> mode 分为以下3种
|------+--------------------------------------------------------------------------------------------------------|
| mode | 说明（程序启动后才能设置成功）                                                                         |
|------+--------------------------------------------------------------------------------------------------------|
| off  | 默认，所有线程自由运行                                                                                 |
| on   | 仅当前线程执行，其他线程暂停                                                                           |
| step | 1. 单步执行某一线程，调试过程中当前线程不会变，其他线程随着被调试线程的单步执行而执行                  |
|      | 2. 该模式下执行 continue、until、finish 时，其他线程也会执行，某一线程若遇到断点，则该线程作为当前线程 |
|------+--------------------------------------------------------------------------------------------------------|

|------------------------+--------------|
| 命令                   | 说明         |
|------------------------+--------------|
| show scheduler-locking | 查看调度器锁 |
|------------------------+--------------|


* Footnotes
[fn:2] 假设name为string；p name.operator=("hello") => 给name赋值为"hello"
[fn:1] p var；p func()
