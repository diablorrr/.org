:PROPERTIES:
:ID:       27145501-fa0b-4b05-a5df-1cd2f6a46226
:END:
#+title: 进程、线程、协程
#+filetags: operating_system

* 进程
1. 运行中的程序， *资源分配* 的基本单位，拥有 *独立的内存空间* ，考虑 *安全* 选进程
   由 *内核调度*
   进程状态保存在 [[id:7a87bf4e-74d0-4760-9979-a6a247a5a384][PCB]]

   #+begin_comment
   独立内存空间 -> 优： *安全性* 较高（进程崩溃不会影响另一个进程）
                   缺：进程 *切换开销* 大（内核参与、需保存整个进程的状态）
   #+end_comment

2. *进程状态*
   1) 运行    ：进程 正在占用CPU
   2) 就绪    ：进程 等待CPU调用
   3) 阻塞    ：进程 等待某事件发生（eg：IO完成），此时给它CPU，它也无法运行
   4) 创建    ：进程 正在被创建
   5) 结束    ：进程 正在被销毁（eg：运行完成 或 出错）
      # 大量的阻塞占用内存，因此有了 挂起状态
   6) 就绪挂起：进程 在外存（硬盘）等待CPU调度
   7) 阻塞挂起：进程 在外存（硬盘）等待某事件发生

3. [[id:eea0107c-ac34-4210-be33-534585e20915][进程间的通信方式]]

4. [[id:d1a53bae-2b04-4f9e-8a40-2f34a04b67bd][僵尸进程、孤儿进程]]

5. 用 [[id:57a3e52f-e77e-439f-a4e5-3dc6e1886e5a][进程调度算法]] 实现单核CPU *并发* 执行多个任务 或 优化多核CPU（多核分配） *并行* 执行 多个任务
   - 并发 :: 同一 *时间段内交替执行* 多个任务（eg：单核CPU交替执行不同任务）
   - 并行 :: 同一 *时刻内同时执行* 多个任务（eg：多核CPU分别同时执行不同任务）

** 图:多进程 :ATTACH:
:PROPERTIES:
:ID:       37528611-c45b-4b04-bfc7-c24d03e88721
:END:
[[attachment:_20250807_174519screenshot.png]]
进程 共享 [[id:cbf178f7-ce4b-435d-bc2c-55cb1e39816e][操作系统内核空间]]


* 线程
1. 进程内执行单元， *CPU调度* 的基本单位， *共享进程内存空间* ，考虑 *性能* 选线程
   由 *内核调度*
   线程状态保存在 [[id:cb213eda-0332-4351-8136-b7712d62c8bd][TCB]]

   #+begin_comment
   共享进程资源 -> 优： *通信效率* 高（共享进程内存）
                        线程 *切换开销* 小（只需保存线程的状态）
                   缺： *安全性* 较低（资源竞争、线程崩溃可能导致整个进程终止）

   共享进程资源的例子：以cpp为例，共享进程的 [[id:ae7fc8d9-0053-45b6-92f4-9a42f1565718][代码段、数据段、BSS段、堆、内存映射段]]）自己有：线程栈、TLS（线程局部存储："线程专属的全局变量"）...
   #+end_comment


** 图:多线程 :ATTACH:
:PROPERTIES:
:ID:       784c244c-7f7f-4e36-be15-7145add1b4f5
:END:
[[attachment:_20250808_144624screenshot.png]]
为什么使用多线程？
可以提高程序并发性（响应速度、数据处理速度 更快），充分利用多核性能


* 协程 [[https://cloud.tencent.com/developer/article/1839604][腾讯云-全菜工程师小辉]]
1. 用户态的（程序控制）线程内执行单元（只是代码流程，并不分割CPU资源）， *直接共享所在线程资源，间接共享所属进程资源*
   由 *程序调度*
   协程状态保存在 *程序定义的结构体*
   一般用于异步

   #+begin_comment
   程序调度 -> 上下文切换开销极小
   #+end_comment
   具体来说：协程就是 有状态的函数

** 图:多协程 :ATTACH:
:PROPERTIES:
:ID:       a31e909b-6f57-4a50-9a11-542baad56706
:END:
[[attachment:_20250808_141134screenshot.png]]
