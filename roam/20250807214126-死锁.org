:PROPERTIES:
:ID:       8984b341-e5ac-4715-b9a6-0ba8fdd70ecf
:END:
#+title: 死锁
#+filetags: operating_system

* 死锁
多个线程因互相等待对方持有资源而无法继续执行的现象
*产生条件* （同时满足下面4个导致死锁）：
1. 互斥        ：某一资源同一时间只能被一个线程访问
2. 持有并等待  ：线程持有资源，同时又在请求其他资源
3. 不可剥夺    ：线程主动释放资源前，不能被其他线程抢占
4. 循环等待    ：线程请求资源的顺序形成闭环
#+begin_example
小咪独占鱼干（互斥），还不让别人抢走（不可剥夺），小咪占着鱼干还想要臭咪的鱼干（持有并等待），臭咪又想要猪咪的鱼干，猪咪又想要小咪的鱼干（循环等待），于是它们三就干等着...
#+end_example


* 解决死锁
** 图:预防死锁 :ATTACH:
:PROPERTIES:
:ID:       7708f37f-aff8-412d-bfef-c392e25babb2
:END:
*排查* ：梳理逻辑，在关键地方打日志
# 因为不是崩溃问题，无法查看调用栈
*解决* ：破坏四大必要条件之一就行；最常见且可行的： *破坏循环等待条件* ；具体做法 ：线程以相同顺序获取锁

图:死锁
[[attachment:_20250808_093347screenshot.png]]
图:破坏循环等待条件

[[attachment:_20250808_093408screenshot.png]]
